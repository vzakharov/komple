<!-- Komple settings -->
<html>
  <head>
    <meta charset="utf-8">
    <title>Komple settings</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <!-- Petite vue -->
    <script src="vue.js" defer></script>
    <!-- Inline CSS -->
    <style>
      .form-group {
        margin-bottom: 0.8em;
      }
      label {
        /* margin-bottom: 0.5em; */
        font-weight: 500;
      }
      body {
        zoom: 0.8;
      }
    </style>
  </head>
  <body>
    <!-- Main div -->
    <div 
      id="app"
      class="m-3"
      style="width: 400px;"
    >
    <!-- Select API -->
    <div class="form-group">
      <label for="select-api">
        Choose an API:
      </label>
      <select
        id="select-api"
        @change="settings.currentApiName = $event.target.value"
      >
        <option 
          v-for="api in settings.apis"
          :key="api.name"
          :value="api.name"
          :selected="api.name === settings.currentApiName"
          v-text="api.name"
        />      
      </select>
      <!-- 
        API fields are:
        {
          name: 'default',                // Arbitrary name for the API
          endpoint: 'https://...',        // The endpoint to use for autocompletion
          auth: 'Bearer ...',             // The authorization token to use for the API. Don't forget to add the Bearer prefix!
          censor: false,                  // Whether to hide the above fields in the configuration modal
          promptKey: 'prompt',            // The key to use for the prompt in the API request body
          suffixKey: 'suffix',            // The key to use for the suffix. Leave empty if the model doesn't support it.
          otherBodyParams: {              // Other parameters to add to the request body (number of tokens, temperature, etc.)
            max_tokens: 50,
            temperature: 0.6,
            stop: '\n'
          },
          arrayKey: 'choices',            // Where is the array of suggestions in the response? Empty if no array is returned.
          resultKey: 'text'               // Where is the result text in the response?
        }
       -->
      <div
       class="py-2"
      >
        <!-- API name -->
        <div class="form-group">
          <label for="api-name">
            API name
          </label>
          <input
            type="text"
            class="form-control"
            id="api-name"
            :value="api.name"
            @input="changeApiName($event.target.value)"
            placeholder="My API"
          />
          <small class="form-text text-muted">
            Any name you want.
          </small>
        </div>
        <!-- API endpoint -->
        <div class="form-group">
          <label for="api-endpoint">
            API endpoint
          </label>
          <input
            :type="api.censor ? 'password' : 'text'"
            class="form-control"
            id="api-endpoint"
            v-model="api.endpoint"
            placeholder="https://..."
          />
        </div>
        <!-- API authorization token -->
        <div class="form-group">
          <label for="api-auth">
            API authorization token
          </label>
          <input
            :type="api.censor ? 'password' : 'text'"
            class="form-control"
            id="api-auth"
            v-model="api.auth"
            placeholder="Bearer sk-..."
          />
        </div>
        <!-- Whether to hide the above fields -->
        <div class="form-group">
          <div class="form-check">
            <input
              type="checkbox"
              class="form-check-input switch"
              id="api-censor"
              v-model="api.censor"
            />
            <label for="api-censor">
              Hide API fields
            </label>
          </div>
        </div>
        <!-- API prompt, suffix, array, result keys -->
        <div class="form-group"
          v-for="key in ['prompt', 'suffix', 'array', 'result']"
        >
          <label :for="`api-${key}`">
            {{ key }} key
          </label>
          <input
            type="text"
            class="form-control"
            :id="`api-${key}`"
            v-model="api[key+'Key']"
            :placeholder="'e.g. ' + {
              prompt: 'prompt',
              suffix: 'suffix',
              array: 'choices',
              result: 'text'
            }[key]"
          />
          <small class="form-text text-muted"
            v-if="['suffix', 'array'].includes(key)"
          >
            Leave empty if {{ key === 'suffix' ? 'the model doesn\'t support text insertion' : 'the API doesn\'t return an array' }}
          </small>
        </div>              
      </div>    
    </div>

    </div>
    <script src="popup.js" defer></script>
  </body>
</html>